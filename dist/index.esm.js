import*as e from"react";import t from"react";var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var o={},c={};!function(e){var n=r&&r.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r};Object.defineProperty(e,"__esModule",{value:!0}),e.scripts=void 0;var o=t;e.scripts={};var c=function(t){var r=document.querySelector('script[src="'+t+'"]');if(r)return e.scripts[t]={loading:!1,error:null,scriptEl:r}};e.default=function(t){var r=t.src,s=t.checkForExisting,a=void 0!==s&&s,l=n(t,["src","checkForExisting"]),u=r?e.scripts[r]:void 0;!u&&a&&r&&i&&(u=c(r));var d=(0,o.useState)(u?u.loading:Boolean(r)),f=d[0],p=d[1],v=(0,o.useState)(u?u.error:null),b=v[0],y=v[1],g=(0,o.useState)(!1),m=g[0],O=g[1];return(0,o.useEffect)((function(){if(i&&r&&!m&&!b){var t;!(u=e.scripts[r])&&a&&(u=c(r)),u?t=u.scriptEl:((t=document.createElement("script")).src=r,Object.keys(l).forEach((function(e){void 0===t[e]?t.setAttribute(e,l[e]):t[e]=l[e]})),u=e.scripts[r]={loading:!0,error:null,scriptEl:t});var n=function(){u&&(u.loading=!1),p(!1),O(!0)},o=function(e){u&&(u.error=e),y(e)};return t.addEventListener("load",n),t.addEventListener("error",o),document.body.appendChild(t),function(){t.removeEventListener("load",n),t.removeEventListener("error",o)}}}),[r]),[f,b]};var i="undefined"!=typeof window&&void 0!==window.document}(c),function(e){var t=r&&r.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.scripts=e.default=void 0;var n=c;Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t(n).default}}),Object.defineProperty(e,"scripts",{enumerable:!0,get:function(){return n.scripts}})}(o);var i=n(o);function s({connectUrl:t}={}){const[r,n]=e.useState("closed"),[o,c]=e.useState(),[s,a]=i({src:t||"https://app.stackone.com/stackone/connect.js",checkForExisting:!0});e.useEffect((()=>{"open"!==r&&"closed"!==r&&(a?"opening"===r&&n("closed"):s||"opening"===r&&o&&(n("open"),Connect.start({...o,onClose:()=>{n("closed"),o.onCancel?.()}})))}),[a,s,r,o]);const l=e.useCallback((e=>{if(a)throw"Could not initiate StackOne Hub.";"open"!==r&&(c(e),n("opening"))}),[s,a]);return{startConnect:l}}export{s as useStackOneHub};
